<!DOCTYPE html>
<html>
<head>
	
	<title>Mini Editor Foto</title>
	<style type="text/css">
        html, body {
            width:100%;
            height:100%;
            overflow:hidden;
            background-color: white;
            font-family: Verdana, Geneva, sans-serif;
            font-size: 12px;
        }
    
        .w3-bar-item img{
            width: 50%;
            height: 50%;
            margin-left: 13px;
            margin-bottom: 10px;
            margin-top: 10px;
        }
    
        canvas{
			position: relative;
			border: 1px solid #000;
        }

		#my-canvas{
			width: 700;
			height:600;
            margin-left: 75px;
            margin-bottom: 20px;
            overflow: hidden;
            background-color: #e0e0e0;
            float: left;
            left: 0;
            border-radius: 5px;
		}
    
        .w3-sidebar{
            float:left;
            background-color: white;
            overflow: hidden;
            height: 1200px;
        }
    
        .w3-button{
            color: #8C001A;
            size: 50px;
        }
    
        .w3-bar-item{
            size: 30px;
            transition: 100ms;
        }

        .w3-bar-item:hover{
        	box-shadow: 6px 6px 6px 6px #e0e0e0;
        }
    
        #stuffToShow {
            display:none;
        }
    
        .checkbox {
            opacity:0.01;
            position: absolute;
            height: 50px;
        }
        

        #checkbox:checked + #stuffToShow {
            display:block;
            position: fixed;
            top:10px;
            left:100px;
            height: 50px;
            z-index: 100;
        }


        #checkbox2:checked + #stuffToShow {
            display:block;
            position: fixed;
            top:60px;
            left:100px;
            height: 50px;
            z-index: 100;
        }

        #stuffToShow .w3-sidebar {
            width: 50px;
            float: left;
            height: auto;
            background-color: white;
            padding: 2px; 
        }
    
        #stuffToShow .w3-sidebar img{
            width: 50px;
            height: 50px;
            margin-left: 0px;
            border-bottom: 1px solid black;
            transition: 200ms;
        }
    
        #stuffToShow .w3-sidebar img:hover{
        	background-color: red;
        	opacity: 0.2;
        	transition: 200ms;
        }

		#page-footer{
			background-color: black;
			color: #cfcfcf;
			padding: 10px;
			position: fixed;
			bottom: 0px;
			height:50px;
			width: 105%;
			box-shadow: 10px 0px 10px 10px #e0e0e0; 
			float:left;
			z-index: 100;
			text-align: center;
			margin-left: -30px;
		}

		.w3-bar-block {
			width: 80px !important;
			box-shadow: 1px 1px 10px 1px #efefef;
		}

	</style>
</head>

<body>
	
			    <div class="w3-sidebar w3-bar-block" style="width:100px"> 
			        <div class="w3-bar-item w3-button" name="desenare" id="desenare">
			            <label for="checkbox" id="checkboxLabel"><img src="Media/desenare.png"></label>
			            <input type="checkbox" class="checkbox" id="checkbox" />
			            <div id="stuffToShow">
			                    <div class="w3-sidebar w3-bar-block"> 
			                    	<div class="w3-bar-item w3-button" name="crop" id="crop">
							            <label for="pensula" id="checkboxLabel7"><img src="Media/pensula.png"></label>
							            <input type="checkbox" class="checkbox" id="pensula" />
							        </div>
									<div class="w3-bar-item w3-button" name="crop" id="crop">
							            <label for="linie" id="checkboxLabel8"><img src="Media/linie.png"></label>
							            <input type="checkbox" class="checkbox" id="linie" />
									</div>
									<div class="w3-bar-item w3-button" name="crop" id="crop">
							            <label for="dreptunghi" id="checkboxLabel9"><img src="Media/dreptunghi.png"></label>
							            <input type="checkbox" class="checkbox" id="dreptunghi" />
							        </div>
			                </div>
			            </div>
			        </div>
			        
			        <div class="w3-bar-item w3-button" name="selectie" id="selectie">
			            <label for="checkbox2" id="checkboxLabel2"><img src="Media/selectie.png"></label>
			            <input type="checkbox" class="checkbox" id="checkbox2" />
			            <div id="stuffToShow">
			                    <div class="w3-sidebar w3-bar-block"> 
			                    <a href="#" class="w3-bar-item w3-button"><img src="Media/desenare.png"></a>
			                    <a href="#" class="w3-bar-item w3-button"><img src="Media/desenare.png"></a>
			                </div>
			            </div>
			        </div>
			        
			        <div class="w3-bar-item w3-button" name="crop" id="crop">
			            <label for="checkbox3" id="checkboxLabel3"><img src="Media/crop.png"></label>
			            <input type="checkbox" class="checkbox" id="checkbox3" />
			        </div>
			        
			        <div class="w3-bar-item w3-button" name="scalare" id="scalare">
			            <label for="checkbox4" id="checkboxLabel4"><img src="Media/scalare.png"></label>
			            <input type="checkbox" class="checkbox" id="checkbox4" />
			        </div>

			        <div class="w3-bar-item w3-button" name="salvare" id="salvare">
			            <label for="checkbox5" id="checkboxLabel5"><img src="Media/salvare.png"></label>
			            <input type="checkbox" class="checkbox" id="checkbox5" />
					</div>
					
					<div class="w3-bar-item w3-button" name="pipeta" id="pipeta">
			            <label for="checkbox6" id="checkboxLabel6"><img src="Media/pipeta.png"></label>
			            <input type="checkbox" class="checkbox" id="checkbox6" />
			        </div>

			      </div>
	<div id="container">
				
		<div role="main">
			<section id="main-content">
				
				<canvas id="my-canvas" width="700" height="600"></canvas>
				<script>
					(function () {
						var canvas = document.getElementById("my-canvas"),
						context = canvas.getContext("2d"),
						img = document.createElement("img"),
						buton_pensula = document.getElementById("pensula"),
						buton_pipeta = document.getElementById("checkbox6"),
						buton_dreptunghi = document.getElementById("dreptunghi"),
						buton_linie = document.getElementById("linie");
						dreptunghi = document.createElement("rect");

						mouseDown = false,
						brushColor = "rgb(0, 0, 0)",
						hasText = true,
						clearCanvas = function () {
							if (hasText) {
								context.clearRect(0, 0, canvas.width, canvas.height);
								hasText = false;
							}
						};

						function sunet(src) {
    						this.sound = document.createElement("audio");
    						this.sound.src = src;
    						this.sound.setAttribute("preload", "auto");
    						this.sound.setAttribute("controls", "none");
    						this.sound.style.display = "none";
    						document.body.appendChild(this.sound);
    						this.play = function(){
       							this.sound.play();
    						}
    						this.stop = function(){
        						this.sound.pause();
    						}    
						}

							
						// Adding instructions
						context.fillText("Trage o imagine in canvas", 240, 200);
						context.fillText("Apasa pe un loc din imagine ca se setezi culoarea pensulei.", 240, 220);
						
						// Image for loading	
						img.addEventListener("load", function () {
							clearCanvas();
							context.drawImage(img, 0, 0);
						}, false);
						
						canvas.addEventListener("mousedown", function (evt) {
										clearCanvas();
										mouseDown = true;
										context.beginPath();
										var x = evt.layerX;
										var y = evt.layerY;
										context.moveTo(x,y);
								}, false);

						// Detect mousedown
						checkbox6.addEventListener("change", function (e) {
							var check_sunet = new sunet("Media/pipeta.wav");
							check_sunet.play(); 		
								
								// Detect mouseup
								canvas.addEventListener("mouseup", function (evt) {
										mouseDown = false;
										var colors = context.getImageData(evt.layerX, evt.layerY, 1, 1).data;
										if(buton_pipeta.checked==true) {
											brushColor = "rgb(" + colors[0] + ", " + colors[1] + ", " + colors[2] + ")";
											buton_pipeta.checked=false;
										}
								}, false);
						}, false);



						// Draw, if mouse button is pressed
						pensula.addEventListener("change", function(e){ 
							var pensula_sunet = new sunet("Media/pensula.wav");
							var desenare_sunet = new sunet("Media/desenare_pensula.wav");
							pensula_sunet.play(); 

							if (buton_pensula.checked==true)
							{
								buton_dreptunghi.checked=false;
								buton_linie.checked=false;
							}				

							canvas.addEventListener("mousemove", function desenare_pensula (evt) {
								if (mouseDown && buton_pensula.checked==true) {
									desenare_sunet.play();
									context.strokeStyle = brushColor;								
									context.lineWidth = 20;
									context.lineJoin = "round";
									context.lineTo(evt.layerX+1, evt.layerY+1);
									context.stroke();
								}
							}); 

						});

						linie.addEventListener("change", function(e) {
							var linie_sunet = new sunet("Media/linie.wav");
							var desenare_sunet = new sunet("Media/desenare_linie.wav");
							linie_sunet.play(); 

							if (buton_linie.checked==true)
							{
								buton_dreptunghi.checked=false;
								buton_pensula.checked=false;
							}

							canvas.addEventListener("mousemove", function desenare_linie(evt) {
								if (mouseDown && buton_linie.checked==true) {
									desenare_sunet.play();
								}
							});

							canvas.addEventListener("mouseup", function desenare_linie(evt) {
								mouseDown=false;
								if(buton_linie.checked==true) {
									desenare_sunet.play();
									context.strokeStyle = brushColor;								
									context.lineWidth = 5;
									context.lineTo(evt.layerX+1, evt.layerY+1);
									context.closePath();
									context.stroke();
								}
							});

						});

						dreptunghi.addEventListener("change", function(e) {
							var dreptunghi_sunet = new sunet("Media/dreptunghi.wav");
							var desenare_sunet = new sunet("Media/desenare_pensula.wav");
							dreptunghi_sunet.play(); 

							if (buton_dreptunghi.checked==true)
							{
								buton_linie.checked=false;
								buton_pensula.checked=false;
								desenare_sunet.play();
							}

							canvas.addEventListener("mousemove", function desenare_dreptunghi (evt) {
								if (mouseDown && buton_dreptunghi.checked==true) {
									desenare_sunet.play();
								}
							});

							canvas.addEventListener("mouseup", function desenare_dreptunghi(evt) {
								mouseDown=false;
								if(buton_linie.checked==true) {
									desenare_sunet.play();
									context.strokeStyle = brushColor;								
									context.lineWidth = 5;
									context.rect(x,y,evt.layerX+1-x,evt.layerY+1-y);
									context.closePath();
									context.stroke();
								}
							});


						});

						// To enable drag and drop
						canvas.addEventListener("dragover", function (evt) {
							evt.preventDefault();
						}, false);

						// Handle dropped image file - only Firefox and Google Chrome
						canvas.addEventListener("drop", function (evt) {
							var drop_sunet = new sunet("Media/drop.wav");
							drop_sunet.play();

							var files = evt.dataTransfer.files;
							if (files.length > 0) {
								var file = files[0];
								if (typeof FileReader !== "undefined" && file.type.indexOf("image") != -1) {
									var reader = new FileReader();
									// Note: addEventListener doesn't work in Google Chrome for this event
									reader.onload = function (evt) {
										img.src = evt.target.result;
									};
									reader.readAsDataURL(file);
								}
							}
							evt.preventDefault();
						}, false);
						
						// Save image
						var saveImage = document.getElementById("checkbox5");
						saveImage.innerHTML = "Save canvas";
						saveImage.addEventListener("click", function (evt) {
							window.open(canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"));
							evt.preventDefault();
						}, false);
						document.getElementById("main-content").appendChild(saveImage);
					})();
				</script>
			</section>
		</div>
		
		<footer id="page-footer" role="contentinfo">
			Andreea Bajenaru / Grupa 1065<br>Facultatea de Cibernetica, Statistica si Informatica Economica / Academia de studii Romane. <br>06/01/2019
		</footer>
	</div>
	
	
	

</body></html>